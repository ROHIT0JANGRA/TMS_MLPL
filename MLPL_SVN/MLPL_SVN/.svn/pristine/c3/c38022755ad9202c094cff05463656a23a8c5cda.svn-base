@{
    ViewBag.Title = "Barcode Print";
}

<link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

@section styles{

    <style type="text/css">
        .glyphicon-refresh-animate {
            -animation: spin .7s infinite linear;
            -webkit-animation: spin2 .7s infinite linear;
        }

        @@-webkit-keyframes spin2 {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(360deg);
            }
        }

        @@keyframes spin {
            from {
                transform: scale(1) rotate(0deg);
            }

            to {
                transform: scale(1) rotate(360deg);
            }
        }

        .prev {
            float: left;
        }

        .next {
            float: right;
        }

        #steps {
            list-style: none;
            width: 100%;
            overflow: hidden;
            margin: 0px;
            padding: 0px;
        }

            #steps li {
                font-size: 24px;
                float: left;
                padding: 10px;
                color: #b0b1b3;
            }

                #steps li span {
                    font-size: 11px;
                    display: block;
                }

                #steps li.current {
                    color: #000;
                }
    </style>

}


<div id="msgInProgress">
    <div id="mySpinner" style="width:32px;height:32px"></div>
    <br />
    <h3>Detecting WCPP utility at client side...</h3>
    <h3><span class="label label-info"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Please wait a few seconds...</span></h3>
    <br />
</div>
<div id="msgInstallWCPP" style="display:none;">
    <h3>#1 Install WebClientPrint Processor (WCPP)!</h3>
    <p>
        <strong>WCPP is a native app (without any dependencies!)</strong> that handles all print jobs
        generated by the <strong>WebClientPrint for ASP.NET component</strong> at the server side. The WCPP
        is in charge of the whole printing process and can be
        installed on <strong>Windows, Linux, Mac & Raspberry Pi!</strong>
    </p>
    <p>
        <a hre>
            <a href="~/Views/Home/Index.cshtml">~/Views/Home/Index.cshtml</a>>
    </p>odynamic.com/downloads/wcpp/" target="_blank" class="btn btn-warning">Download and Install WCPP from Neodynamic website</a><br />
    </p>
    <h3>#2 After installing WCPP...</h3>
    <p>
        <a href="@Url.Action("Samples", "Home")" class="btn btn-info">You can go and test the printing page...</a>
    </p>

</div>
<div id="dvPrintInfo" style="display:none">
    <div class="container">
        <div class="row">
            <form id="myForm" action="">

                @* Store User's SessionId *@
                <input type="hidden" id="sid" name="sid" value="@HttpContext.Current.Session.SessionID" />

                @*Collect User's printer settings*@

                <fieldset>
                    <legend>Client Printer Settings</legend>

                    @*<div>
                            WebClientPrint does support all common printer communications like USB-Installed
                            Drivers, Network/IP-Ethernet, Serial COM-RS232 and Parallel (LPT).
                            <br />
                            <br />
                            I want to:&nbsp;&nbsp;
                            <select id="pid" name="pid" class="form-control">
                                <option selected="selected" value="0">Use Default Printer</option>
                                <option value="1">Display a Printer dialog</option>
                                <option value="2">Use an installed Printer</option>
                                <option value="3">Use an IP/Etherner Printer</option>
                                <option value="4">Use a LPT port</option>
                                <option value="5">Use a RS232 (COM) port</option>
                            </select>
                            <br />
                            <br />
                            <div id="info" class="alert alert-info" style="font-size:11px;"></div>
                            <br />
                        </div>*@

                    <div id="installedPrinter">
                        <div id="loadPrinters" name="loadPrinters">
                            WebClientPrint can detect the installed printers in your machine. <a onclick="javascript:jsWebClientPrint.getPrinters();" class="btn btn-success">Load installed printers...</a>
                            <br /><br />
                        </div>
                        @*<label for="installedPrinterName">Select an installed Printer:</label>
                            <select name="installedPrinterName" id="installedPrinterName" class="form-control"></select>*@
                        <div class="col-sm-4">
                            <label for="installedPrinterName">Select an installed Printer:</label>
                            <select name="installedPrinterName" id="installedPrinterName" class="form-control"></select>
                        </div>

                        <script type="text/javascript">
                        //var wcppGetPrintersDelay_ms = 0;
                        var wcppGetPrintersTimeout_ms = 60000; //60 sec
                        var wcppGetPrintersTimeoutStep_ms = 500; //0.5 sec
                        function wcpGetPrintersOnSuccess() {
                            // Display client installed printers
                            if (arguments[0].length > 0) {
                                var p = arguments[0].split("|");
                                var options = '<option value="">Select</option>';
                                for (var i = 0; i < p.length; i++) {
                                    options += '<option value="' + (i + 1) + '">' + p[i] + '</option>';
                                }
                                $('#installedPrinterName').html(options);
                                $('#installedPrinterName').focus();
                                $('#loadPrinters').hide();
                            } else {
                                alert("No printers are installed in your system.");
                            }
                        }

                        function wcpGetPrintersOnFailure() {
                            // Do something if printers cannot be got from the client
                            alert("No printers are installed in your system.");
                        }
                        </script>

                    </div>

                </fieldset>
                <fieldset style="display:none">
                    <legend>Printer Commands</legend>
                    <p>
                        Enter the printer's commands you want to send and is supported by the specified printer (ESC/P, PCL, ZPL, EPL, DPL, IPL, EZPL, etc).
                        <br /><br />
                        <b>NOTE:</b> You can use the <b>hex notation of VB or C# for non-printable characters</b> e.g. for Carriage Return (ASCII 13) you could use &H0D or 0x0D
                    </p>
                    <div class="alert alert-info" style="font-size:11px;">
                        <b>Upload Files</b><br />
                        This online demo does not allow you to upload files. So, if you have a file containing the printer commands like a PRN file, Postscript, PCL, ZPL, etc, then we recommend you to <a href="//neodynamic.com/products/printing/raw-data/aspnet-mvc/download/" target="_blank">download WebClientPrint</a> and test it by using the sample source code included in the package. Feel free to <a href="http://www.neodynamic.com/support" target="_blank">contact our Tech Support</a> for further assistance, help, doubts or questions.
                    </div>
                    <textarea id="printerCommands" name="printerCommands" rows="10" cols="80" class="form-control" style="min-width: 100%"></textarea>
                </fieldset>
                <fieldset id="lnkPrint" style="display:none">
                    <a href="#" onclick="javascript:doClientPrint();" class="btn btn-lg btn-success">Print</a>
                    <br /><br />
                </fieldset>

            </form>

        </div>
    </div>
    <br />
    <br />
    <br />
</div>

@section scripts{
    <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/bootstrap.min.js"></script>
    @* Register the WebClientPrint script code generated by DemoPrintCommandsController. *@

    @Html.Raw(ViewBag.WCPScript);
    <script type="text/javascript">

        //var wcppPingDelay_ms = 5000;

        var wcppPingTimeout_ms = 60000; //60 sec
        var wcppPingTimeoutStep_ms = 500; //0.5 sec

        function wcppDetectOnSuccess() {
            // WCPP utility is installed at the client side
            // redirect to WebClientPrint sample page

            // get WCPP version
            var wcppVer = arguments[0];
            if (wcppVer.substring(0, 1) == "6") {
                $('#dvPrintInfo').show();
                $("#installedPrinter").show();
                $('#msgInProgress').hide();
                $('#msgInstallWCPP').hide();
                $(".page_loader").fadeOut();
            }
            else //force to install WCPP v6.0
                wcppDetectOnFailure();
        }

        function wcppDetectOnFailure() {
            // It seems WCPP is not installed at the client side
            // ask the user to install it
            $('#msgInProgress').hide();
            $('#msgInstallWCPP').show();
        }

        function doClientPrint() {

            //collect printer settings and raw commands
            var printerSettings = $("#myForm").serialize();

            //store printer settings in the server cache...
            $.post('DemoPrintCommands/ClientPrinterSettings',
                printerSettings
            );

            // Launch WCPP at the client side for printing...
            var sessionId = $("#sid").val();
            jsWebClientPrint.print('sid=' + sessionId);

        }


        $(document).ready(function () {
            //jQuery-based Wizard

            //change printer options based on user selection
            //$("#pid").change(function () {
            //    var printerId = $("select#pid").val();

            //    displayInfo(printerId);
            //    hidePrinters();
            //    if (printerId == 2)
            //        $("#installedPrinter").show();
            //    else if (printerId == 3)
            //        $("#netPrinter").show();
            //    else if (printerId == 4)
            //        $("#parallelPrinter").show();
            //    else if (printerId == 5)
            //        $("#serialPrinter").show();
            //});

            $("#installedPrinterName").change(function () {

                if ($("#installedPrinterName").val() != '')
                    $("#lnkPrint").show();
                else
                    $("#lnkPrint").hide();
            });

            hidePrinters();
            displayInfo(0);
        });

        function displayInfo(i) {
            if (i == 0)
                $("#info").html('This will make the WCPP to send the commands to the printer installed in your machine as "Default Printer" without displaying any dialog!');
            else if (i == 1)
                $("#info").html('This will make the WCPP to display the Printer dialog so you can select which printer you want to use.');
            else if (i == 2)
                $("#info").html('Please specify the <b>Printer\'s Name</b> as it figures installed under your system.');
            else if (i == 3)
                $("#info").html('Please specify the Network Printer info.<br /><strong>On Linux &amp; Mac</strong> it\'s recommended you install the printer through <strong>CUPS</strong> and set the assigned printer name to the <strong>"Use an installed Printer"</strong> option on this demo.');
            else if (i == 4)
                $("#info").html('Please specify the Parallel Port which your printer is connected to.<br /><strong>On Linux &amp; Mac</strong> you must install the printer through <strong>CUPS</strong> and set the assigned printer name to the <strong>"Use an installed Printer"</strong> option on this demo.');
            else if (i == 5)
                $("#info").html('Please specify the Serial RS232 Port info which your printer does support.<br /><strong>On Linux &amp; Mac</strong> you must install the printer through <strong>CUPS</strong> and set the assigned printer name to the <strong>"Use an installed Printer"</strong> option on this demo.');
        }

        function hidePrinters() {
            $("#installedPrinter").hide(); $("#netPrinter").hide(); $("#parallelPrinter").hide(); $("#serialPrinter").hide();
        }




        /* FORM to WIZARD */
        /* Created by jankoatwarpspeed.com */

        (function ($) {
            $.fn.formToWizard = function () {

                var element = this;

                var steps = $(element).find("fieldset");
                var count = steps.size();


                // 2
                $(element).before("<ul id='steps'></ul>");

                steps.each(function (i) {
                    $(this).wrap("<div id='step" + i + "'></div>");
                    $(this).append("<p id='step" + i + "commands'></p>");

                    // 2
                    var name = $(this).find("legend").html();
                    $("#steps").append("<li id='stepDesc" + i + "'>Step " + (i + 1) + "<span>" + name + "</span></li>");

                    if (i == 0) {
                        createNextButton(i);
                        selectStep(i);
                    }
                    else if (i == count - 1) {
                        $("#step" + i).hide();
                        createPrevButton(i);
                    }
                    else {
                        $("#step" + i).hide();
                        createPrevButton(i);
                        createNextButton(i);
                    }
                });

                function createPrevButton(i) {
                    var stepName = "step" + i;
                    $("#" + stepName + "commands").append("<a href='#' id='" + stepName + "Prev' class='prev btn btn-info'>< Back</a>");

                    $("#" + stepName + "Prev").bind("click", function (e) {
                        $("#" + stepName).hide();
                        $("#step" + (i - 1)).show();

                        selectStep(i - 1);
                    });
                }

                function createNextButton(i) {
                    var stepName = "step" + i;
                    $("#" + stepName + "commands").append("<a href='#' id='" + stepName + "Next' class='next btn btn-info'>Next ></a>");

                    $("#" + stepName + "Next").bind("click", function (e) {
                        $("#" + stepName).hide();
                        $("#step" + (i + 1)).show();

                        selectStep(i + 1);
                    });
                }

                function selectStep(i) {
                    $("#steps li").removeClass("current");
                    $("#stepDesc" + i).addClass("current");
                }

            }
        })(jQuery);

    </script>


    @* WCPP detection script generated by HomeController *@

    @Html.Raw(ViewBag.WCPPDetectionScript)


}

