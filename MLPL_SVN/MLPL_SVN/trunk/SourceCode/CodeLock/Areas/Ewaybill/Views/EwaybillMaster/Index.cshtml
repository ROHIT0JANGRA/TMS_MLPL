@using Secure_Coding.MvcSecurityExtensions;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
<div class="widget-wrap">
    <div class="row container-fluid col-12 p-0 m-0 mb-4">
        <div class="form-group m-0 col-12 col-sm-6 col-md-3">
            <h4>Ewaybill Task Scheduler</h4>
            <button class="mt-3 btn btn-sm btn-primary" id="taskSchedulerButton">On/Off Scheduler</button>
            <div id="status"></div>
        </div>
    </div>
</div>

@section scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>

    <script>
        $(function () {
            // Function to update scheduler status
            function updateSchedulerStatus() {
            $.ajax({
                url: '@Url.Action("GetSchedulerStatus", "EwaybillMaster")',
                type: 'GET',
                success: function (data) {
                    $('#status').text(data.message);
                },
                error: function (xhr, status, error) {
                    $('#status').text('Error: ' + error);
                }
            });
        }
        // Initial update of scheduler status when page loads
        updateSchedulerStatus();
        // Periodically update scheduler status every 10 seconds (adjust as needed)
        // setInterval(updateSchedulerStatus, 10000); // Every 10 seconds
        });

        $(document).ready(function () {
            $('#taskSchedulerButton').click(function () {
                $.ajax({
                    url: '@Url.Action("EwaybillTaskScheduler", "EwaybillMaster")',
                    type: 'POST',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data.message);
                        alert(data.message);
                        location.reload();
                    }
                })
            })
        });
    </script>
}